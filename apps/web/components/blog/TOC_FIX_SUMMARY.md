# Table of Contents Scroll Fix - Summary

## Problem
The Table of Contents (TOC) scroll-to-section functionality was not working. When users clicked on TOC links, the page would not scroll to the corresponding heading.

## Root Cause
The slug generation in `extractHeadings()` function was using a custom algorithm that didn't match the slug generation used by the `rehype-slug` plugin. This caused a mismatch between:
- The slugs in the TOC links (generated by `extractHeadings()`)
- The actual IDs on the heading elements (generated by `rehype-slug`)

## Solution

### 1. Installed github-slugger
The `rehype-slug` plugin uses the `github-slugger` library internally. We needed to use the same library in our `extractHeadings()` function to ensure consistent slug generation.

### 2. Updated mdx.ts
**File**: `docs-maps/apps/web/lib/blog/mdx.ts`

**Changes**:
- Added import: `import GithubSlugger from 'github-slugger'`
- Updated `extractHeadings()` function to use `GithubSlugger`:

```typescript
export function extractHeadings(source: string): Heading[] {
  const headings: Heading[] = []
  const slugger = new GithubSlugger()
  
  const headingRegex = /^(#{1,6})\s+(.+)$/gm
  
  let match
  while ((match = headingRegex.exec(source)) !== null) {
    const level = match[1].length
    const text = match[2].trim()
    
    // Use github-slugger to generate slug (same as rehype-slug)
    const slug = slugger.slug(text)
    
    headings.push({ level, text, slug })
  }
  
  return headings
}
```

### 3. Improved Scroll Behavior
**File**: `docs-maps/apps/web/components/blog/table-of-contents.tsx`

**Changes**:
- Improved scroll offset calculation for better positioning
- Changed from `yOffset = -100` to `offsetPosition = elementPosition + window.pageYOffset - 120`
- This ensures headings appear below the fixed navbar when scrolled to

```typescript
const handleClick = (e: React.MouseEvent<HTMLAnchorElement>, slug: string) => {
  e.preventDefault();
  
  const element = document.getElementById(slug);
  if (element) {
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - 120;
    
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
    
    window.history.pushState(null, '', `#${slug}`);
    setActiveId(slug);
  }
};
```

## How It Works Now

1. **Slug Generation**: Both `extractHeadings()` and `rehype-slug` now use the same `github-slugger` algorithm
2. **Matching IDs**: TOC links now reference the correct heading IDs in the DOM
3. **Smooth Scroll**: Clicking a TOC link smoothly scrolls to the heading with proper offset for the navbar
4. **URL Update**: The URL hash is updated without causing a page jump
5. **Active State**: The clicked TOC item is immediately highlighted

## Testing

### Type Check
```bash
npm run typecheck
```
✅ Passed - No TypeScript errors

### Lint Check
```bash
npm run lint
```
✅ Passed - No ESLint warnings or errors

### Manual Testing Required
1. Start the dev server: `npm run dev`
2. Navigate to any blog post with headings
3. Click on TOC links
4. Verify:
   - Page scrolls smoothly to the heading
   - Heading appears below the navbar (not hidden)
   - URL hash updates correctly
   - Active TOC item is highlighted

## Files Modified
1. `docs-maps/apps/web/lib/blog/mdx.ts` - Updated slug generation
2. `docs-maps/apps/web/components/blog/table-of-contents.tsx` - Improved scroll behavior

## Dependencies
- `github-slugger` - Already available as a transitive dependency of `rehype-slug`

## Related Components (No Changes Needed)
- `docs-maps/apps/web/components/blog/post-layout.tsx` - Already properly structured
- `docs-maps/apps/web/components/blog/related-posts.tsx` - Already using PostCard correctly
- `docs-maps/apps/web/components/blog/post-card.tsx` - Consistent card styling
